{% extends "base.html" %}
{% block conteudo %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow">
                <div class="card-body p-5">
                    <h2 class="text-center mb-4">Criar Conta</h2>
                    
                    {% if erros and "GERAL" in erros %}
                    <div class="alert alert-danger" role="alert">
                        {{ erros['GERAL'] }}
                    </div>
                    {% endif %}

                    <form method="post" action="/cadastro">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="nome" name="nome"
                                        placeholder="Nome Completo"
                                        value="{{ dados['nome'] if dados and 'nome' in dados.keys() }}" required
                                        autofocus>
                                    <label for="nome">Nome Completo</label>
                                    {% if erros and "NOME" in erros.keys() %}
                                    <div class="invalid-feedback">
                                        {{ erros['NOME'] }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="cpf" name="cpf" placeholder="CPF"
                                        value="{{ dados['cpf'] if dados and 'cpf' in dados.keys() }}" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}"
                                        title="Formato: 000.000.000-00" required>
                                    <label for="cpf">CPF</label>
                                    {% if erros and "CPF" in erros.keys() %}
                                    <div class="invalid-feedback">
                                        {{ erros['CPF'] }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="tel" class="form-control" id="telefone" name="telefone"
                                        placeholder="Telefone" value="{{ dados['telefone'] if dados and 'telefone' in dados.keys() }}"
                                        pattern="\(\d{2}\) \d{4,5}-\d{4}"
                                        title="Formato: (00) 0000-0000 ou (00) 00000-0000" required>
                                    <label for="telefone">Telefone</label>
                                    {% if erros and "TELEFONE" in erros.keys() %}
                                    <div class="invalid-feedback">
                                        {{ erros['TELEFONE'] }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="email" name="email" placeholder="E-mail"
                                value="{{ dados['email'] if dados and 'email' in dados.keys() }}" required>
                            <label for="email">E-mail</label>
                            {% if erros and "EMAIL" in erros.keys() %}
                            <div class="invalid-feedback">
                                {{ erros['EMAIL'] }}
                            </div>
                            {% endif %}
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="password" class="form-control" id="senha" name="senha"
                                        placeholder="Senha" minlength="6" required>
                                    <label for="senha">Senha</label>
                                    {% if erros and "SENHA" in erros.keys() %}
                                    <div class="invalid-feedback">
                                        {{ erros['SENHA'] }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="password" class="form-control" id="confirmar_senha"
                                        name="confirmar_senha" placeholder="Confirmar Senha" minlength="6" required>
                                    <label for="confirmar_senha">Confirmar Senha</label>
                                    {% if erros and "CONFIRMAR_SENHA" in erros.keys() %}
                                    <div class="invalid-feedback">
                                        {{ erros['CONFIRMAR_SENHA'] }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi-person-plus"></i> Criar Conta
                            </button>
                        </div>
                    </form>

                    <hr class="my-4">

                    <div class="text-center">
                        <p class="mb-0">Já tem uma conta?</p>
                        <a href="/login" class="btn btn-outline-primary mt-2">
                            <i class="bi-box-arrow-in-right"></i> Fazer Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Máscaras para CPF e Telefone
    document.getElementById('cpf').addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 11) value = value.slice(0, 11);
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value;
    });

    document.getElementById('telefone').addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 11) value = value.slice(0, 11);
        if (value.length > 6) {
            if (value.length === 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else {
                value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            }
        } else if (value.length > 2) {
            value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
        } else {
            value = value.replace(/(\d{0,2})/, '($1');
        }
        e.target.value = value;
    });

    // Validação de senha
    document.querySelector('form').addEventListener('submit', function (e) {
        const senha = document.getElementById('senha').value;
        const confirmarSenha = document.getElementById('confirmar_senha').value;

        if (senha !== confirmarSenha) {
            e.preventDefault();
            alert('As senhas não coincidem!');
            document.getElementById('confirmar_senha').focus();
        }
    });
</script>
{% endblock %}